        <!-- Review Delete Confirmation Modal -->
    <div id="review-delete-modal" class="delete-modal">
            <div class="delete-modal-content">
                <div class="delete-icon"><i class="fas fa-exclamation-triangle"></i></div>
                <h3>Delete Review</h3>
                <p id="review-delete-desc">Are you sure you want to delete this review?</p>
                <div class="delete-modal-actions">
                    <button class="delete-cancel-btn" id="review-delete-cancel"><i class="fas fa-times"></i> Cancel</button>
                    <button class="delete-confirm-btn control-btn" id="review-delete-confirm">
                        <span class="btn-text"><i class="fas fa-trash"></i> Delete</span>
                        <span class="btn-spinner"><div class="spinner-circle"></div></span>
                    </button>
                </div>
            </div>
        </div>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Step it Up Learning</title>
    <meta name="description" content="Admin panel for managing Step it Up Learning products">
    <link rel="icon" href="../assets/logo.png" type="image/png">
    <link rel="stylesheet" href="../assets/admin.css">
    <link rel="stylesheet" href="../assets/admin-logs.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Session Expiry Countdown (always visible) -->
    <div id="session-expiry-banner" class="session-expiry-banner" style="display:flex;align-items:center;gap:0.5rem;justify-content:center;background:#fffbe6;color:#b7791f;padding:0.5rem 1rem;font-size:1.1rem;">
                <i class="fas fa-hourglass-half"></i>
                <span>Session expires in <span id="session-expiry-countdown">2:00</span></span>
        </div>
        <style>
            .session-expiry-banner {
                position: sticky;
                top: 0;
                z-index: 1000;
                box-shadow: 0 2px 6px rgba(0,0,0,0.04);
            }
        </style>
    </div>
    <!-- Login Modal -->
    <div id="login-modal" class="login-modal show">
        <!-- Session Expiry Warning Modal -->
        <div id="session-expiry-modal" class="session-expiry-modal" style="display:none;">
            <div class="modal-backdrop"></div>
            <div class="modal-content warning">
                <div class="warning-animation">
                    <div class="warning-icon">
                        <i class="fas fa-hourglass-half"></i>
                    </div>
                </div>
                <div class="modal-text">
                    <h3>Session Expiring Soon</h3>
                    <p>Your admin session will expire in <span id="session-expiry-countdown">2:00</span>.</p>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" onclick="adminManager.hideSessionExpiryModal()">OK</button>
                </div>
            </div>
        </div>
        <div class="login-backdrop">
            <div class="login-content">
                <div class="login-header">
                    <h2><i class="fas fa-shield-alt"></i> Admin Access</h2>
                    <p>Enter your credentials to access the admin panel</p>
                </div>
                <form id="login-form" class="login-form">
                    <div class="form-group">
                        <label for="username">
                            <i class="fas fa-user"></i>
                            Username
                        </label>
                        <input type="text" id="username" name="username" required autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label for="password">
                            <i class="fas fa-lock"></i>
                            Password
                        </label>
                        <input type="password" id="password" name="password" required autocomplete="current-password">
                    </div>
                    <button type="submit" class="login-btn">
                        <span class="btn-text">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </span>
                        <div class="btn-spinner">
                            <div class="spinner-circle"></div>
                        </div>
                    </button>
                    <div id="login-error" class="login-error"></div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main Admin Panel -->
    <div id="admin-panel" class="admin-panel">
        <!-- Header -->
        <header class="admin-header">
            <div class="header-content">
                <div class="header-left">
                    <h1><i class="fas fa-tachometer-alt"></i> Admin Panel</h1>
                    <p>Step it Up Learning - Product Management</p>
                </div>
                <div class="header-right">
                    <button onclick="adminManager.cancelEdit()" class="cancel-edit-btn" id="cancel-edit-btn" style="display: none;">
                        <i class="fas fa-times"></i> Cancel Edit
                    </button>
                    <button id="logout-btn" class="logout-btn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="admin-main">
            <div class="admin-container">
                <!-- Upload Form -->
                <div class="upload-section">
                    <div class="section-header">
                        <h2><i class="fas fa-cloud-upload-alt"></i> Upload New Product</h2>
                        <p>Add a new educational resource to the store</p>
                    </div>

                    <form id="product-form" class="product-form">
                        <!-- Product Details -->
                        <div class="form-section">
                            <h3><i class="fas fa-info-circle"></i> Product Information</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-name">
                                        Product Name <span class="required">*</span>
                                    </label>
                                    <input type="text" id="product-name" name="name" required 
                                           placeholder="Enter product name">
                                </div>
                                
                                <div class="form-group">
                                    <label for="product-category">
                                        Category <span class="required">*</span>
                                    </label>
                                    <select id="product-category" name="category" required>
                                        <option value="">Select a category</option>
                                        <option value="worksheets">Worksheets</option>
                                        <option value="games">Games</option>
                                        <option value="lessons">Lessons</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="product-price">
                                        Price (CAD) <span class="required">*</span>
                                    </label>
                                    <div class="price-input">
                                        <span class="price-symbol">CAD$</span>
                                        <input type="text" id="product-price" name="price" 
                                               pattern="[0-9]+(\.[0-9]{1,2})?" min="0" required placeholder="0.00" 
                                               title="Enter a valid price (e.g., 10.99)">
                                    </div>
                                </div>
                                
                                <div class="form-group checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="product-featured" name="featured">
                                        <span class="checkbox-custom"></span>
                                        Mark as Featured
                                    </label>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="product-description">
                                    Description
                                </label>
                                <div class="formatting-toolbar" id="formatting-toolbar">
                                    <div class="toolbar-group">
                                        <button type="button" class="toolbar-btn" data-action="bold" title="Bold (Ctrl+B)">
                                            <i class="fas fa-bold"></i>
                                        </button>
                                        <button type="button" class="toolbar-btn" data-action="italic" title="Italic (Ctrl+I)">
                                            <i class="fas fa-italic"></i>
                                        </button>
                                        <button type="button" class="toolbar-btn" data-action="underline" title="Underline (Ctrl+U)">
                                            <i class="fas fa-underline"></i>
                                        </button>
                                    </div>
                                    <div class="toolbar-separator"></div>
                                    <div class="toolbar-group">
                                        <button type="button" class="toolbar-btn" data-action="heading" title="Heading">
                                            <i class="fas fa-heading"></i>
                                        </button>
                                        <button type="button" class="toolbar-btn" data-action="list" title="Bullet List">
                                            <i class="fas fa-list-ul"></i>
                                        </button>
                                        <button type="button" class="toolbar-btn" data-action="link" title="Insert Link">
                                            <i class="fas fa-link"></i>
                                        </button>
                                    </div>
                                    <div class="toolbar-separator"></div>
                                    <div class="toolbar-group">
                                        <button type="button" class="toolbar-btn" data-action="clear" title="Clear Formatting">
                                            <i class="fas fa-remove-format"></i>
                                        </button>
                                    </div>
                                </div>
                                <div id="product-description-editor" class="rich-text-editor" contenteditable="true" aria-label="Product description" placeholder="Enter product description..."></div>
                                <input type="hidden" id="product-description" name="description" />
                                <div class="formatting-help">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Use the toolbar to format your text. Changes apply immediately.</span>
                                </div>
                            </div>
                        </div>

                        <!-- File Uploads -->
                        <div class="form-section">
                            <h3><i class="fas fa-file-upload"></i> File Uploads</h3>
                            <p class="edit-note" id="edit-note" style="display: none;">
                                <i class="fas fa-info-circle"></i>
                                Leave files empty to keep existing files, or upload new files to replace them.
                            </p>
                            
                            <div class="upload-grid">
                                <!-- Main Product File -->
                                <div class="upload-area fixed-size">
                                    <div class="upload-header">
                                        <h4><i class="fas fa-file"></i> Main Product File</h4>
                                        <span class="required" id="product-file-required">Required</span>
                                        <span class="optional" id="product-file-optional" style="display: none;">Optional</span>
                                    </div>
                                    <div class="file-drop-zone" data-upload-type="product">
                                        <div class="drop-zone-content">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                            <p>Drop your file here or <span class="browse-link">browse</span></p>
                                            <small>PDF, DOC, DOCX, ZIP files up to 50MB</small>
                                        </div>
                                        <input type="file" id="product-file" name="product-file" 
                                               accept=".pdf,.doc,.docx,.zip" required>
                                        <div class="upload-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill"></div>
                                            </div>
                                            <div class="progress-text">0%</div>
                                        </div>
                                        <div class="file-info"></div>
                                    </div>
                                </div>

                                <!-- Preview File -->
                                <div class="upload-area fixed-size">
                                    <div class="upload-header">
                                        <h4><i class="fas fa-eye"></i> Preview File</h4>
                                        <span class="optional">Optional</span>
                                    </div>
                                    <div class="file-drop-zone" data-upload-type="preview">
                                        <div class="drop-zone-content">
                                            <i class="fas fa-image"></i>
                                            <p>Drop preview file here or <span class="browse-link">browse</span></p>
                                            <small>PDF, Images up to 10MB</small>
                                        </div>
                                        <input type="file" id="preview-file" name="preview-file" 
                                               accept=".pdf,.jpg,.jpeg,.png,.gif">
                                        <div class="upload-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill"></div>
                                            </div>
                                            <div class="progress-text">0%</div>
                                        </div>
                                        <div class="file-info"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- New Image Upload Sections -->
                            <div class="upload-grid">
                                <!-- Resource Images -->
                                <div class="upload-area fixed-size">
                                    <div class="upload-header">
                                        <h4><i class="fas fa-images"></i> Resource Images</h4>
                                        <span class="optional">Optional</span>
                                    </div>
                                    <div class="file-drop-zone" data-upload-type="resource-images">
                                        <div class="drop-zone-content">
                                            <i class="fas fa-images"></i>
                                            <p>Drop resource images here or <span class="browse-link">browse</span></p>
                                            <small>JPG, PNG, GIF files up to 5MB each</small>
                                        </div>
                                        <input type="file" id="resource-images" name="resource-images" 
                                               accept=".jpg,.jpeg,.png,.gif" multiple>
                                        <div class="upload-progress">
                                            <div class="progress-bar">
                                                <div class="progress-fill"></div>
                                            </div>
                                            <div class="progress-text">0%</div>
                                        </div>
                                        <div class="file-info"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Submit Section -->
                        <div class="form-section">
                            <div class="submit-section">
                                <button type="submit" class="submit-btn fixed-size">
                                    <span class="btn-text">
                                        <i class="fas fa-plus"></i> Create Product
                                    </span>
                                    <div class="btn-spinner" aria-hidden="true" style="display: none;">
                                        <div class="spinner-circle"></div>
                                    </div>
                                </button>
                                <p class="submit-note">
                                    <i class="fas fa-info-circle"></i>
                                    Make sure all information is correct before submitting
                                </p>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Manage Products Section -->
                <div class="manage-section">
                    <div class="section-header">
                        <h2><i class="fas fa-cog"></i> Manage Products</h2>
                        <p>View, edit, and delete existing products</p>
                    </div>

                    <div class="manage-content">
                        <div class="manage-controls">
                            <button id="refresh-products" class="control-btn">
                                <i class="fas fa-refresh"></i> Refresh
                            </button>
                            <div class="search-box">
                                <input type="text" id="product-search" placeholder="Search products...">
                                <i class="fas fa-search"></i>
                            </div>
                        </div>

                        <div id="products-loading" class="products-loading" style="display: none;">
                            <div class="products-spinner"></div>
                            <p>Loading products...</p>
                        </div>

                        <div id="products-grid" class="products-grid"></div>

                        <div id="no-products" class="no-products-message" style="display: none;">
                            <i class="fas fa-box-open"></i>
                            <h3>No Products Found</h3>
                            <p>Create your first product using the upload form above.</p>
                        </div>
                    </div>
                </div>

                <!-- Resources Upload Section -->
                <div class="manage-section" id="resources-upload-section">
                    <div class="section-header">
                        <h2><i class="fas fa-folder-open"></i> Upload Resources</h2>
                        <p>Upload files to the Supabase "resources" bucket into Grade folders</p>
                    </div>
                    <div class="manage-content">
                        <div class="resources-uploader-controls">
                            <div class="resources-field">
                                <label for="grade-folder-select">Select grade folder</label>
                                <select id="grade-folder-select" class="grade-select">
                                    <option value="Kinder">Kinder</option>
                                    <option value="Grade 1">Grade 1</option>
                                    <option value="Grade 2">Grade 2</option>
                                    <option value="Grade 3">Grade 3</option>
                                    <option value="Grade 4">Grade 4</option>
                                    <option value="Grade 5">Grade 5</option>
                                    <option value="Grade 6">Grade 6</option>
                                </select>
                            </div>
                            <div class="resources-field">
                                <label for="resources-file-input">Choose files</label>
                                <input id="resources-file-input" class="resources-file-input" type="file" multiple />
                            </div>
                            <div class="resources-actions">
                                <button type="button" id="start-upload-btn" class="control-btn"><i class="fas fa-upload"></i> Start Upload</button>
                                <button type="button" id="clear-queue-btn" class="control-btn"><i class="fas fa-trash"></i> Clear Queue</button>
                            </div>
                        </div>
                        <div class="upload-queue" id="upload-queue" aria-live="polite"></div>
                        <div class="upload-summary" id="upload-summary">0/0 completed â€¢ 0 failed</div>
                        <p class="upload-help">Tip: You can drag and drop files anywhere in this section. Each file uploads independently with its own progress bar.</p>
                    </div>
                </div>

                <!-- Manage Free Resources Section -->
                <div class="manage-section" id="free-resources-section">
                    <div class="section-header">
                        <h2><i class="fas fa-boxes-stacked"></i> Manage Free Resources</h2>
                        <p>View and delete files in the Supabase "resources" bucket</p>
                    </div>
                    <div class="manage-content">
                        <div class="manage-controls">
                            <div style="display:flex; gap:0.5rem; align-items:center;">
                                <label for="free-grade-filter" style="font-weight:600; color:#2d3748;">Grade</label>
                                <select id="free-grade-filter" class="grade-select">
                                    <option value="All">All Grades</option>
                                    <option value="Kinder">Kinder</option>
                                    <option value="Grade 1">Grade 1</option>
                                    <option value="Grade 2">Grade 2</option>
                                    <option value="Grade 3">Grade 3</option>
                                    <option value="Grade 4">Grade 4</option>
                                    <option value="Grade 5">Grade 5</option>
                                    <option value="Grade 6">Grade 6</option>
                                </select>
                            </div>
                            <div style="display:flex; gap:0.5rem; align-items:center;">
                                <label style="display:flex; align-items:center; gap:0.4rem; color:#2d3748;">
                                    <input id="free-select-all" type="checkbox" style="accent-color:#2c77cc;"> Select All
                                </label>
                                <button id="free-refresh-btn" class="control-btn"><i class="fas fa-rotate"></i> Refresh</button>
                                <button id="free-bulk-delete-btn" class="control-btn" disabled><i class="fas fa-trash"></i> Delete Selected</button>
                            </div>
                        </div>
                        <div id="free-resources-list" class="free-resources-list"></div>
                    </div>
                </div>

                <!-- Admin Logs Section -->
                <div class="manage-section" id="admin-logs-section">
                    <div class="section-header">
                        <h2><i class="fas fa-clipboard-list"></i> Admin Logs</h2>
                        <p>Recent admin sessions and activity</p>
                    </div>

                    <div class="manage-content">
                        <!-- Sessions Log -->
                        <div class="logs-block">
                            <div class="logs-header">
                                <h3><i class="fas fa-user-shield"></i> Admin Sessions</h3>
                                <div class="logs-actions">
                                    <button id="sessions-reset-btn" class="control-btn">
                                        <span class="btn-text"><i class="fas fa-rotate"></i> Reset</span>
                                        <span class="btn-spinner" style="display: none;"><div class="spinner-circle"></div></span>
                                    </button>
                                    <button id="sessions-download-btn" class="control-btn">
                                        <span class="btn-text"><i class="fas fa-download"></i> Download</span>
                                        <span class="btn-spinner" style="display: none;"><div class="spinner-circle"></div></span>
                                    </button>
                                </div>
                            </div>
                            <div class="logs-table-wrapper">
                                <table class="logs-table" id="sessions-table">
                                    <thead>
                                        <tr>
                                            <th>Username</th>
                                            <th>IP</th>
                                            <th>User Agent</th>
                                            <th>Created</th>
                                            <th>Expires</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="sessions-tbody"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Activity Log -->
                        <div class="logs-block">
                            <div class="logs-header">
                                <h3><i class="fas fa-list-check"></i> Admin Activity</h3>
                                <div class="logs-actions">
                                    <button id="activity-reset-btn" class="control-btn">
                                        <span class="btn-text"><i class="fas fa-rotate"></i> Reset</span>
                                        <span class="btn-spinner" style="display: none;"><div class="spinner-circle"></div></span>
                                    </button>
                                    <button id="activity-download-btn" class="control-btn">
                                        <span class="btn-text"><i class="fas fa-download"></i> Download</span>
                                        <span class="btn-spinner" style="display: none;"><div class="spinner-circle"></div></span>
                                    </button>
                                </div>
                            </div>
                            <div class="logs-table-wrapper">
                                <table class="logs-table" id="activity-table">
                                    <thead>
                                        <tr>
                                            <th>When</th>
                                            <th>Username</th>
                                            <th>Action</th>
                                            <th>Resource</th>
                                            <th>Resource ID</th>
                                            <th>IP</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activity-tbody"></tbody>
                                </table>
                            </div>
                            <div class="logs-pagination" id="activity-pagination">
                              <button class="control-btn" id="activity-prev"><i class="fas fa-chevron-left"></i> Prev</button>
                              <div class="logs-page-info" id="activity-page-info">Page 1</div>
                              <button class="control-btn" id="activity-next">Next <i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>

                        <!-- Manage Reviews -->
                        <div class="logs-block">
                            <div class="logs-header">
                                <h3><i class="fas fa-comments"></i> Manage Reviews</h3>
                                <div class="logs-actions">
                                    <button id="reviews-refresh-btn" class="control-btn">
                                        <span class="btn-text"><i class="fas fa-refresh"></i> Refresh</span>
                                        <span class="btn-spinner" style="display: none;"><div class="spinner-circle"></div></span>
                                    </button>
                                </div>
                            </div>
                            <div class="logs-table-wrapper">
                                <table class="logs-table" id="reviews-table">
                                    <thead>
                                        <tr>
                                            <th>Created</th>
                                            <th>Image</th>
                                            <th>Reviewer</th>
                                            <th>Text</th>
                                            <th>Flags</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="reviews-tbody"></tbody>
                                </table>
                            </div>
                            <div class="logs-pagination" id="reviews-pagination">
                              <button class="control-btn" id="reviews-prev"><i class="fas fa-chevron-left"></i> Prev</button>
                              <div class="logs-page-info" id="reviews-page-info">Page 1</div>
                              <button class="control-btn" id="reviews-next">Next <i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Success Modal -->
    <div id="success-modal" class="success-modal">
        <div class="modal-backdrop">
            <div class="modal-content">
                <div class="success-animation">
                    <div class="success-checkmark">
                        <div class="check-icon">
                            <span class="icon-line line-tip"></span>
                            <span class="icon-line line-long"></span>
                            <div class="icon-circle"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-text">
                    <h3>Product Created Successfully!</h3>
                    <p>Your product has been uploaded and is now available in the store.</p>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn secondary" onclick="adminManager.closeSuccessModal()">
                        Create Another
                    </button>
                    <a href="https://shop.stepituplearning.ca" class="modal-btn primary">
                        <i class="fas fa-store"></i> View Store
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="error-modal">
        <div class="modal-backdrop">
            <div class="modal-content error">
                <div class="error-animation">
                    <div class="error-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                </div>
                <div class="modal-text">
                    <h3>Upload Failed</h3>
                    <p id="error-message">An error occurred while uploading your product.</p>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" onclick="adminManager.closeErrorModal()">
                        Try Again
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Success Modal -->
    <div id="delete-success-modal" class="success-modal">
        <div class="modal-backdrop">
            <div class="modal-content">
                <div class="success-animation">
                    <div class="success-checkmark">
                        <div class="check-icon">
                            <span class="icon-line line-tip"></span>
                            <span class="icon-line line-long"></span>
                            <div class="icon-circle"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-text">
                    <h3>Product Deleted Successfully!</h3>
                    <p>The product and all associated data has been removed from the store.</p>
                </div>
                <div class="modal-actions">
                    <button class="modal-btn primary" onclick="adminManager.closeDeleteSuccessModal()">
                        Continue
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Review Editor Modal -->
    <div id="review-editor-modal" class="reviews-modal" style="display:none;">
      <div class="reviews-modal-backdrop"></div>
      <div class="reviews-modal-content">
        <div class="reviews-modal-header">
          <h3><i class="fas fa-pen"></i> Edit Review</h3>
          <button class="reviews-modal-close" id="review-editor-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="reviews-modal-body">
          <div class="reviews-field">
            <label>Reviewer</label>
            <input type="text" id="review-editor-name" />
          </div>
          <div class="reviews-field">
            <label>Rating</label>
            <div class="star-rating" id="review-editor-rating" aria-label="Set rating from 1 to 5">
              <i data-value="1" class="fa-star far"></i>
              <i data-value="2" class="fa-star far"></i>
              <i data-value="3" class="fa-star far"></i>
              <i data-value="4" class="fa-star far"></i>
              <i data-value="5" class="fa-star far"></i>
            </div>
          </div>
          <div class="reviews-field">
            <label>Text</label>
            <textarea id="review-editor-text" rows="8"></textarea>
          </div>
        </div>
        <div class="reviews-modal-footer">
          <button class="control-btn reviews-cancel-btn" id="review-editor-cancel">Cancel</button>
          <button class="control-btn" id="review-editor-save">
            <span class="btn-text"><i class="fas fa-save"></i> Save</span>
            <span class="btn-spinner"><div class="spinner-circle"></div></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Insert Link Modal -->
    <div id="insert-link-modal" class="reviews-modal" style="display:none;">
      <div class="reviews-modal-backdrop"></div>
      <div class="reviews-modal-content">
        <div class="reviews-modal-header">
          <h3><i class="fas fa-link"></i> Insert Link</h3>
          <button class="reviews-modal-close" id="insert-link-close"><i class="fas fa-times"></i></button>
        </div>
        <div class="reviews-modal-body">
          <div class="reviews-field">
            <label for="insert-link-url">URL</label>
            <input type="url" id="insert-link-url" placeholder="https://example.com" />
          </div>
          <div class="reviews-field">
            <label for="insert-link-text">Text (optional)</label>
            <input type="text" id="insert-link-text" placeholder="Link text" />
          </div>
          <div class="reviews-field">
            <label style="display:flex; align-items:center; gap:0.5rem;">
              <input type="checkbox" id="insert-link-newtab" checked /> Open in new tab
            </label>
          </div>
        </div>
        <div class="reviews-modal-footer">
          <button class="control-btn reviews-cancel-btn" id="insert-link-cancel">Cancel</button>
          <button class="control-btn" id="insert-link-insert">
            <span class="btn-text"><i class="fas fa-link"></i> Insert</span>
            <span class="btn-spinner"><div class="spinner-circle"></div></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Supabase Client for Realtime functionality -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      // Initialize Supabase client (only if needed for realtime)
      // For now, disable realtime to prevent errors until proper configuration is available
      if (typeof supabase !== 'undefined' && false) {
        window.supabase = supabase.createClient('YOUR_SUPABASE_URL', 'YOUR_SUPABASE_ANON_KEY');
      }
    </script>

    <script src="../scripts/admin.js"></script>
    <script src="../scripts/resources-uploader.js"></script>
    <script src="../scripts/resources-manager.js"></script>

    <script>
    // Enhanced form handling for edit mode and ensure review delete modal logic is initialized after DOMContentLoaded
    document.addEventListener('DOMContentLoaded', function() {
        // Update UI when editing mode changes
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' || mutation.type === 'characterData') {
                    const isEditing = adminManager && adminManager.currentEditingProduct;
                    const cancelBtn = document.getElementById('cancel-edit-btn');
                    const editNote = document.getElementById('edit-note');
                    const productFileRequired = document.getElementById('product-file-required');
                    const productFileOptional = document.getElementById('product-file-optional');
                    const productFileInput = document.getElementById('product-file');
                    if (cancelBtn) {
                        cancelBtn.style.display = isEditing ? 'flex' : 'none';
                    }
                    if (editNote) {
                        editNote.style.display = isEditing ? 'block' : 'none';
                    }
                    // Make product file optional when editing
                    if (productFileRequired && productFileOptional && productFileInput) {
                        if (isEditing) {
                            productFileRequired.style.display = 'none';
                            productFileOptional.style.display = 'inline';
                            productFileInput.removeAttribute('required');
                        } else {
                            productFileRequired.style.display = 'inline';
                            productFileOptional.style.display = 'none';
                            productFileInput.setAttribute('required', 'required');
                        }
                    }
                }
            });
        });
        observer.observe(document.body, {
            childList: true,
            subtree: true,
            characterData: true
        });

        // Ensure review delete modal logic is initialized after DOMContentLoaded
        if (window.adminManager && typeof adminManager.wireReviewsTableRowEvents === 'function') {
            adminManager.wireReviewsTableRowEvents();
        }
    });
    </script>
    <!-- Free Resources Delete Modal -->
    <div id="free-delete-modal" class="delete-modal">
      <div class="delete-modal-content">
        <div class="delete-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <h3>Delete Resources</h3>
        <p id="free-delete-desc">Are you sure you want to delete the selected resource(s)?</p>
        <div class="free-delete-list" id="free-delete-list" style="max-height:180px; overflow:auto; text-align:left; margin:0.5rem 0 1rem; color:#4a5568;"></div>
        <div class="delete-modal-actions">
          <button class="delete-cancel-btn" id="free-delete-cancel"><i class="fas fa-times"></i> Cancel</button>
          <button class="delete-confirm-btn control-btn" id="free-delete-confirm">
            <span class="btn-text"><i class="fas fa-trash"></i> Delete</span>
            <span class="btn-spinner"><div class="spinner-circle"></div></span>
          </button>
        </div>
      </div>
    </div>

</body>
</html>
